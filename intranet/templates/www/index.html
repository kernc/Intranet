{% extends "www/base-second.html" %}
{% load www i18n %}
{% load url from future %}

{% block extrahead %}
<script type='text/javascript'>

$(document).ready(function() {

    $('#subscribe_mailinglist').keypress(function (e) {
        var self = $(this);
        $('.response').text("Prosim pritisnite Enter za potrditev vnosa")
        if (e.which === 13) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                data: self.serialize(),
                url: self.attr('action'),
                success: function (text) {
                    self.find('i').text(text);
                },
                error: function (text) {
                    self.find('i').text("Nekaj je slo narobe, poskusite znova kasneje!");
                }
            });
        }
     });

    $.getJSON("/ajax/index/events/", function(o) {
        // add events
	var c = $(".carousel-inner");
	if (o == null || o.events.length == 0) {
		var html = '<div class="item active">\
			<p>Ni dogodkov</p>\
		</div>';
				
		$(c).append(html);
		return;
	}

        $(o.events).each(function()  {
            var cls = $(c).find(".item").length == 0 ? "item active" : "item";
            var attending = $.map(this.attending, function(a, i) {
		return '<img src="//graph.facebook.com/' + a.id + '/picture/square" width="40" height="40" title="' + a.name + '" />';
            }).join("");
            
            var html = '<div class="' + cls + '"><img class="poster" src="' + this.image + '" />\
                <div class="carousel-caption">\
                    <div class="carousel-announce">' + this.announce + '<br/><br/>Attending:<br/>' + attending + '</div>\
                    <p style="height: 30px; vertical-align: text-bottom; margin-top: 1em; ">' + this.title + '<span class="project" style="float: right">' + this.project + '</span></p></div></div>';
            $(c).html(html);
        });
    });
 });
</script>
<style type="text/css">
    .carousel .carousel-caption .carousel-announce { display: none; }
    .carousel:hover .carousel-announce  { display: block; }
</style>

{% endblock %}

{% block content %}
  
    <div class="hero-unit">
        <p class="ac">Prihajajoči dogodki v Multimedijskem centru Kiberpipa</p>

        <div id="macbook_carousel">
            <div id="carousel" class="carousel slide" rel="carousel">
                <!-- Carousel items -->				
                <div class="carousel-inner">
                	<div class="item active">
				<img src="http://placehold.it/600x355&text=nalagam%20.." />
                	</div>
                </div>

                <!-- Carousel navigation -->
                <a class="carousel-control left" href="#carousel" data-slide="prev">&lsaquo;</a>
                <a class="carousel-control right" href="#carousel" data-slide="next">&rsaquo;</a>
            </div>
        </div>

    </div><!--/ end of .hero-unit-->

    <hr />
    <div class="container">
        <div class="row">
            <div class="span4 thenews">
                <h2>{% trans "News" %}</h2>

                <ol class="news">
                {% for n in both %}
                <li>
                    <a href="{{ n.get_absolute_url }}"><h3>{{ n.title }}</h3></a>
                    {% if n.image %}<img src="{{ n.image.url }}" width="35%" style="float: right; padding: 0 1em 0 1em;" />{% endif %}

                    {% if n.text %}
                    {{ n.text|sanitize|safe|truncatewords:"60" }}<br />
                    {% else %}
                    {{ n.content|sanitize|safe|truncatewords:"60" }}<br />
                    {% endif %}
                    <i>{% trans "Published by" %} {{ n.author }} {% trans "on" %} {% if n.date %}{{ n.date }}{% else %}{{ n.date_modified }}{% endif %}</i>
                </li>
                {% endfor %}
                </ol>

                <p><a href="#">Več novic</a></p>
            </div>
            <div class="span4">
                <h2>{% trans "Media" %}</h2>

                <h3>Recent videos</h3>
                {% for video in videos %}
                <ol class="recent_videos">
                	<li>
                		<a href="{{ video.play_url }}">
                            <img class="thumb" src="{{ video.image_url }}" alt="{{ video.title }}" />
                            <img class="overlay" src="{{ settings.STATIC_URL }}www/images/vod_overlay.png" alt="" title="" />
                        </a>
                		<label>{{ video.title }}</label>
                	</li>
                </ol>
                {% endfor %}

                <h3>Recent photos</h3>
                
                {% for picture in pictures %}
                <ol class="recent_videos">
                    <li>
                        <a href="{{ picture.url }}"><img src="{{ picture.thumb_url }}" alt="{{ picture.title}}" /></a><br />
                        <label>{{ picture.title }}</label>
                    </li>
                </ol>
                {% endfor %}
            </div>
            <div class="span4">
                <h2>{% trans "Social" %}</h2>

                <p><a href="/feeds/all/"><i class="icon-rss"></i> RSS</a></p>

                <span>{% trans "Would you like to subscribe to information about weekly events?" %}</span>
                <form id="subscribe_mailinglist" method="post" action="{% url 'ajax_subscribe_mailinglist' %}">
                   {{ emailform.as_table }}
                   <p><i class="response"></i></p>
                </form>

                <div class="fb-like-box" data-href="http://www.facebook.com/kiberpipa" data-width="292" data-show-faces="true" data-stream="false" data-header="false"></div>

                <ul class="tweets">
                    {% for tweet in tweets %}
                    <li>
                        <img class="tweet-profile-image" src="{{ tweet.user.profile_image_url }}" alt="{{ tweet.user.screen_name }}" title="{{ tweet.user.screen_name }}">
                        <div class="tweet-inner">
                            <b><a href="http://twitter.com/{{ tweet.user.screen_name }}" target="_blank">{{ tweet.user.screen_name }}</a></b><br/>
                            <p class="tweer-text" style="font-size: smaller">{{ tweet.text|urlize }}</p>
                        </div>
                    </li>
                  {% endfor %}
                <ul>
            </div>
        </div>
        
    </div>
{% endblock %}
    
